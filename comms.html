<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Silent Beacon - Secure Communications Portal</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      color: #0f0;
      font-family: 'Courier New', monospace;
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
    }

    .container {
      text-align: center;
      margin-top: 5vh;
      color: #0f0;
      text-shadow: 0 0 10px #0f0, 0 0 20px #0f0;
    }

    h1 {
      font-size: 3em;
      margin-bottom: 20px;
    }

    .form-container {
      width: 400px;
      margin: auto;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #0f0;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 20px #0f0;
    }

    label {
      display: block;
      text-align: left;
      margin-top: 10px;
      margin-bottom: 5px;
      color: #0f0;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      background: black;
      border: 1px solid #0f0;
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 1em;
    }

    textarea {
      height: 100px;
      resize: none;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
    }

    button {
      padding: 10px 20px;
      background: black;
      border: 1px solid #0f0;
      color: #0f0;
      cursor: pointer;
      font-family: 'Courier New', monospace;
    }

    button:hover {
      background: #0f0;
      color: black;
    }

    .confirm {
      display: none;
      margin-top: 15px;
      font-weight: bold;
      color: #0f0;
    }

    .confirm.show {
      display: block;
    }

    .error {
      margin-top: 15px;
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>
  <div class="container">
    <h1>Silent Beacon</h1>
    <div class="form-container">
      <form id="commsForm">
        <label for="from">From</label>
        <input type="email" id="from" name="from" required>

        <label for="subject">Subject</label>
        <input type="text" id="subject" name="subject" required>

        <label for="message">Message</label>
        <textarea id="message" name="message" required></textarea>

        <div class="button-group">
          <button type="button" onclick="window.location.reload();">Cancel</button>
          <button type="reset">Clear</button>
          <button type="submit">Send</button>
        </div>
      </form>
      <div class="confirm" id="confirm">✔ Transmission Sent</div>
      <div class="error" id="error"></div>
    </div>
  </div>

  <script>
    // ✅ FIXED: single relay URL constant
    const RELAY_URL = "https://silentbeacon-relay.yourdomain.workers.dev/"; 

    document.getElementById("commsForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const confirmBox = document.getElementById("confirm");
      const errorBox = document.getElementById("error");

      errorBox.textContent = "";

      const from = document.getElementById("from").value;
      const subject = document.getElementById("subject").value;
      const message = document.getElementById("message").value;

      try {
        const response = await fetch(RELAY_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ from, subject, message })
        });

        if (response.ok) {
          confirmBox.classList.add("show");
          setTimeout(() => confirmBox.classList.remove("show"), 4000);
          document.getElementById("commsForm").reset();
        } else {
          errorBox.textContent = "Error: Unable to send message.";
        }
      } catch (err) {
        errorBox.textContent = "Error: Unable to send message.";
      }
    });

    // Matrix background (unchanged)
    (function(){
      const canvas = document.getElementById('matrix');
      const ctx = canvas.getContext('2d');
      let W,H,COLS,FS; let dropsBack=[],speedBack=[]; let dropsFront=[],speedFront=[];
      const GLYPHS="アイウエオカキクケコサシスセソ...0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+-*/=<>()[]{}|\\";
      const SPEED=0.15;
      function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;FS=Math.max(12,Math.min(24,Math.floor(W/100)));COLS=Math.floor(W/FS);dropsBack=new Array(COLS);speedBack=new Array(COLS);dropsFront=new Array(COLS);speedFront=new Array(COLS);for(let x=0;x<COLS;x++){dropsBack[x]=Math.random()*-H;speedBack[x]=2+Math.random()*3;dropsFront[x]=Math.random()*-H;speedFront[x]=4+Math.random()*4;}}
      function draw(){ctx.fillStyle="rgba(0,0,0,0.05)";ctx.fillRect(0,0,W,H);ctx.fillStyle="#0f0";ctx.font=FS+"px monospace";for(let i=0;i<COLS;i++){let text=GLYPHS.charAt(Math.floor(Math.random()*GLYPHS.length));ctx.fillText(text,i*FS,dropsBack[i]*FS);if(dropsBack[i]*FS>H&&Math.random()>0.975)dropsBack[i]=0;dropsBack[i]+=speedBack[i]*SPEED;ctx.fillText(text,i*FS,dropsFront[i]*FS);if(dropsFront[i]*FS>H&&Math.random()>0.975)dropsFront[i]=0;dropsFront[i]+=speedFront[i]*SPEED;}}
      window.addEventListener("resize",resize);resize();setInterval(draw,33);
    })();
  </script>
</body>
</html>
